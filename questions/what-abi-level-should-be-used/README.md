# What ABI Version Should Be Used for `parser.c`?

As mentioned in the discussion for ["Should Generated Parser Source Be
Committed?"](../should-parser-source-be-committed/README.md), most
parser / grammar repositories currently do.

It turns out that the tree-sitter library has a notion of an ABI:

```c
/**
 * The latest ABI version that is supported by the current version of the
 * library. When Languages are generated by the Tree-sitter CLI, they are
 * assigned an ABI version number that corresponds to the current CLI version.
 * The Tree-sitter library is generally backwards-compatible with languages
 * generated using older CLI versions, but is not forwards-compatible.
 */
```

So what version should be used?

## Discussion

The cli is typically built around the tree-sitter library that's in
the same monorepos, and the [above
comment](https://github.com/tree-sitter/tree-sitter/blob/5766b8a0a785ea34fceb479a94f7fe24c9daae2f/lib/include/tree_sitter/api.h#L17-L23)
is from within the source of the library.

Thus, which ABI is used for one's generated parser source (typically
wired into `src/parser.c`), usually depends on specifically which
version (or build) of the `tree-sitter` cli was used when invoking the
`generate` subcommand.

For release versions of the `tree-sitter` cli, the default ABI became:

* [14](https://github.com/tree-sitter/tree-sitter/commit/e2fe380a08408ff42eada21f8723f653e6da6606) in version 0.20.7 (2022-09)
* [15](https://github.com/tree-sitter/tree-sitter/commit/ce93d8fd9b73fe586cf6c42ca3988051a7952623) in version 0.25.0 (2025-02)

Note that in version 0.20.3, it became possible to specify generation
of at least one level lower via the [`--abi` option to the `generate`
subcommand](https://github.com/tree-sitter/tree-sitter/pull/1599/commits/516fd6f6def1615cb5dc004ab41c348c7de6d182).

The following is an incomplete table of which cli versions defaulted
to which ABI levels:

```
ABI   Version   Release
---   -------   -------
  9    0.14.0   2019-02
 10    0.15.2   2019-06
 11    0.16.0   2019-12
 12    0.17.0   2020-09
 12    0.18.0   2021-01
 13    0.19.0   2021-03
 13    0.20.0   2021-06
 14    0.20.7   2022-09
 14    0.20.8   2023-04
 14    0.20.9   2024-01
 14    0.21.0   2024-02
 14    0.22.0   2024-03
 14    0.22.1   2024-03
 14    0.22.2   2024-03
 14    0.22.3   2024-04
 14    0.22.4   2024-04
 14    0.22.5   2024-04
 14    0.22.6   2024-05
 14    0.23.0   2024-08
 14    0.23.1   2024-10
 14    0.23.2   2024-10
 14    0.24.0   2024-10
 14    0.24.1   2024-10
 14    0.24.2   2024-10
 14    0.24.3   2024-10
 14    0.24.4   2024-11
 14    0.24.5   2024-12
 14    0.24.6   2024-12
 14    0.24.7   2025-01
 15    0.25.0   2025-02
 15    0.25.1   2025-02
 15    0.25.2   2025-02
 15    0.25.3   2025-03
 15    0.25.4   2025-05
 15    0.25.5   2025-05
```

Below is a distribution of ABI numbers for locally fetched data:

```
ABI: Count

9: 9
10: 2
11: 5
12: 4
13: 75
14: 314
15: 39

Total found: 448
```

By percentage of collected parsers, this translates to:

* 9 (2.0%)
* 10 (2.2%)
* 11 (1.1%)
* 12 (0.9%)
* 13 (16.7%)
* 14 (70.1%)
* 15 (8.7%)

For ABI 9-12, perhaps mostly updates are no longer being made.

